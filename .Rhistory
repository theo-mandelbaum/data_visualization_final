air_quality_2021 <- read.csv(here("data/annual_aqi_by_county_2021.csv"))
air_quality_2022 <- read.csv(here("data/annual_aqi_by_county_2021.csv"))
population_data <- read_excel(here("data/co-est2020int-pop.xlsx"), skip=3)
unique_topics <- unique(chronic_diseases$Topic)
print(unique_topics)
chronic_diseases %>%
filter(Topic == "Cancer") %>%
pull(Question) %>%
unique()
chronic_diseases %>%
filter(Topic == "Tobacco") %>%
pull(Question) %>%
unique()
chronic_diseases %>%
filter(Topic == "Sleep") %>%
pull(Question) %>%
unique()
chronic_diseases %>%
filter(Topic == "Nutrition, Physical Activity, and Weight Status") %>%
pull(Question) %>%
unique()
respiratory_diseases <- chronic_diseases %>%
filter(
Topic %in% c("Asthma", "Cancer", "Tobacco", "Nutrition, Physical Activity, and Weight Status") &
(
(Topic == "Cancer" & Question == "Lung and bronchial cancer mortality among all people, underlying cause") |
(Topic == "Tobacco" & Question %in% c(
"Quit attempts in the past year among adult current smokers",
"Current cigarette smoking among adults",
"Cigarette smoking during pregnancy among women with a recent live birth",
"Current electronic vapor product use among high school students"
)) |
(Topic == "Nutrition, Physical Activity, and Weight Status" & Question %in% c(
"Children and adolescents aged 6-13 years meeting aerobic physical activity guideline",
"Met aerobic physical activity guideline among high school students",
"Met aerobic physical activity guideline for substantial health benefits, adults"
)) |
(Topic == "Asthma") |
(Topic == "Chronic Obstructive Pulmonary Disease")
)
)
population_data_cleaned <- population_data %>%
filter(.[[1]] != "United States") %>%
select(1, 8:ncol(.)) %>%
setNames(c("Name", paste0(2015:2020))) %>%
mutate(
County = Name %>%
sub("^\\.", "", .) %>%            # remove leading dot
sub("\\s*County,.*$", "", .)      # remove ' County, ...'
)
air_quality_all <- bind_rows(
air_quality_2015,
air_quality_2016,
air_quality_2017,
air_quality_2018,
air_quality_2019,
air_quality_2020
)
# Modify population data for easy joining with AQI
population_long <- population_data_cleaned %>%
pivot_longer(
cols = starts_with("20"), # get just the years
names_to = "Year",
values_to = "Population"
) %>%
mutate(Year = as.integer(Year))
# Group Air Quality by State
aqi_county <- air_quality_all %>%
group_by(County) %>%
summarise(AQI = mean(Max.AQI, na.rm = TRUE))
scatter_data <- population_long %>%
left_join(aqi_county, by = c("County")) %>%
filter(!is.na(AQI) & !is.na(Population))
ggplot(scatter_data, aes(x = Population, y = AQI, color = AQI)) +
geom_point(alpha = 0.7, size = 2) +
scale_x_continuous(labels = scales::comma) +
scale_color_continuous(
limits = c(0, 450)
) +
scale_y_continuous(
limits = c(0, 450),  # clip y-axis to a reasonable max
) +
labs(
title = "County Population vs Average Max AQI",
x = "County Population",
y = "Average Max AQI",
color = "AQI"
) +
theme_minimal(base_size = 14)
# Combine all air quality datasets into one long table
aqi_long <- bind_rows(
air_quality_2015 %>% mutate(Year = 2015),
air_quality_2016 %>% mutate(Year = 2016),
air_quality_2017 %>% mutate(Year = 2017),
air_quality_2018 %>% mutate(Year = 2018),
air_quality_2019 %>% mutate(Year = 2019),
air_quality_2020 %>% mutate(Year = 2020),
air_quality_2018 %>% mutate(Year = 2021),
air_quality_2018 %>% mutate(Year = 2022)
)
# Average AQI per year
aqi_yearly <- aqi_long %>%
group_by(Year) %>%
summarise(Avg_AQI = mean(Max.AQI, na.rm = TRUE))
ggplot(aqi_yearly, aes(x = Year, y = Avg_AQI)) +
geom_line(size = 1.2, color = "steelblue") +
geom_point(size = 3, color = "steelblue") +
scale_x_continuous(breaks = 2015:2021) +
labs(
title = "Average Maximum AQI by Year",
x = "Year",
y = "Average Max AQI"
) +
theme_minimal(base_size = 14)
# Build a dataset of illness rates by year and illness type
illness_long <- respiratory_diseases %>%
filter(!is.na(DataValue)) %>%
mutate(
Illness = case_when(
Topic == "Asthma" ~ "Asthma",
Topic == "Chronic Obstructive Pulmonary Disease" ~ "COPD",
Topic == "Cancer" ~ "Lung Cancer",
Topic == "Tobacco" ~ "Smoking-Related",
Topic == "Nutrition, Physical Activity, and Weight Status" ~ "Activity (Respiratory-Linked)",
TRUE ~ Topic
),
# Use YearStart when available, otherwise YearEnd
Year = if_else(!is.na(YearStart), YearStart, YearEnd)
) %>%
group_by(Year, Illness) %>%
summarise(Rate = mean(DataValue, na.rm = TRUE), .groups = "drop")
# Plot
ggplot(illness_long, aes(x = Year, y = Rate, color = Illness)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_x_continuous(breaks = sort(unique(illness_long$Year))) +
labs(
title = "Respiratory Illness Rates Over Time",
x = "Year",
y = "Rate per 100,000",
color = "Illness Type"
) +
theme_minimal(base_size = 14)
counties_shp <- read_sf(here("data/dtl_cnty.shp"))
us_states <- read_sf(here("data/ne_110m_admin_1_states_provinces.shp"))
us_main <- us_states %>%
filter(!name %in% c("Alaska", "Hawaii"))
usa <- ggplot() +
geom_sf(data = us_main,
aes(fill = postal),
size = 1,
alpha = .5) +
geom_sf_label_repel(data = us_main,
aes(label = postal),
size = 3) +
labs(x="", y="")
usa
counties_shp <- read_sf(here("data/dtl_cnty.shp"))
us_states <- read_sf(here("data/ne_110m_admin_1_states_provinces.shp"))
us_main <- us_states %>%
filter(!name %in% c("Alaska", "Hawaii"))
usa <- ggplot() +
geom_sf(data = us_main,
aes(fill = postal),
size = 1,
alpha = .5) +
geom_sf_label_repel(data = us_main,
aes(label = postal),
size = 3) +
labs(x="", y="") +
theme(legend.position = "F") +
annotation_north_arrow(location = "bl",
which_north = "T",
style = north_arrow_fancy_orienteering(),
pad_x = unit(0.8, "in"), pad_y = unit(.2, "in")) +
annotation_scale(location = "bl",
width_hint = 0.25)
usa
counties_shp <- read_sf(here("data/dtl_cnty.shp"))
us_states <- read_sf(here("data/ne_110m_admin_1_states_provinces.shp"))
us_main <- us_states %>%
filter(!name %in% c("Alaska", "Hawaii"))
usa <- ggplot() +
geom_sf(data = us_main,
size = 1,
alpha = .5) +
geom_sf_label_repel(data = us_main,
aes(label = postal),
size = 3) +
labs(x="", y="") +
theme(legend.position = "F") +
annotation_north_arrow(location = "bl",
which_north = "T",
style = north_arrow_fancy_orienteering(),
pad_x = unit(0.8, "in"), pad_y = unit(.2, "in")) +
annotation_scale(location = "bl",
width_hint = 0.25)
usa
View(respiratory_diseases)
View(respiratory_diseases)
names(respiratory_diseases)
us_states <- read_sf(here("data/ne_110m_admin_1_states_provinces.shp"))
us_main <- us_states %>%
filter(!name %in% c("Alaska", "Hawaii"))
usa <- ggplot() +
geom_sf(data = us_main,
size = 1,
alpha = .5) +
geom_sf_label_repel(data = us_main,
aes(label = postal),
size = 3) +
labs(x="", y="") +
theme(legend.position = "F") +
annotation_north_arrow(location = "bl",
which_north = "T",
style = north_arrow_fancy_orienteering(),
pad_x = unit(0.8, "in"), pad_y = unit(.2, "in")) +
annotation_scale(location = "bl",
width_hint = 0.25)
disease_data_state <- respiratory_diseases %>%
mutate(postal = LocationAbbr) +
select(DataValue, postal)
view(respiratory_diseases)
names(respiratory_diseases)
respiratory_diseases %>%
glimpse()
us_states <- read_sf(here("data/ne_110m_admin_1_states_provinces.shp"))
us_main <- us_states %>%
filter(!name %in% c("Alaska", "Hawaii"))
usa <- ggplot() +
geom_sf(data = us_main,
size = 1,
alpha = .5) +
geom_sf_label_repel(data = us_main,
aes(label = postal),
size = 3) +
labs(x="", y="") +
theme(legend.position = "F") +
annotation_north_arrow(location = "bl",
which_north = "T",
style = north_arrow_fancy_orienteering(),
pad_x = unit(0.8, "in"), pad_y = unit(.2, "in")) +
annotation_scale(location = "bl",
width_hint = 0.25)
disease_data_state <- respiratory_diseases %>%
mutate(postal = LocationAbbr) %>%
select(DataValue, postal)
names(us_main)
View(disease_data_state)
us_states <- read_sf(here("data/ne_110m_admin_1_states_provinces.shp"))
us_main <- us_states %>%
filter(!name %in% c("Alaska", "Hawaii"))
usa <- ggplot() +
geom_sf(data = us_main,
size = 1,
alpha = .5) +
geom_sf_label_repel(data = us_main,
aes(label = postal),
size = 3) +
labs(x="", y="") +
theme(legend.position = "F") +
annotation_north_arrow(location = "bl",
which_north = "T",
style = north_arrow_fancy_orienteering(),
pad_x = unit(0.8, "in"), pad_y = unit(.2, "in")) +
annotation_scale(location = "bl",
width_hint = 0.25)
disease_data_state <- respiratory_diseases %>%
mutate(postal = LocationAbbr) %>%
select(DataValue, postal)
us_main_joined <- us_main %>%
left_join(disease_data_state, by = "postal")
ggplot() +
geom_sf(data = us_main_joined,
aes(fill = DataValue),
color = "black",
size = 0.4) +
scale_fill_viridis_c(option = "plasma", na.value = "grey90") +
theme_minimal() +
labs(fill = "Respiratory\nDisease Rate",
title = "Respiratory Disease by State")
View(us_main_joined)
View(disease_data_state)
View(disease_data_state)
View(disease_data_state)
knitr::opts_chunk$set(
collapse = TRUE,
message = FALSE
)
library(tidyverse)
library(here)
library(dplyr)
library(readxl)
library(viridis)
library(sf)
library(ggsflabel)
library(ggspatial)
chronic_diseases <- read.csv(here("data/U.S._Chronic_Disease_Indicators.csv"))
air_quality_2015 <- read.csv(here("data/annual_aqi_by_county_2015.csv"))
air_quality_2016 <- read.csv(here("data/annual_aqi_by_county_2016.csv"))
air_quality_2017 <- read.csv(here("data/annual_aqi_by_county_2017.csv"))
air_quality_2018 <- read.csv(here("data/annual_aqi_by_county_2018.csv"))
air_quality_2019 <- read.csv(here("data/annual_aqi_by_county_2019.csv"))
air_quality_2020 <- read.csv(here("data/annual_aqi_by_county_2020.csv"))
air_quality_2021 <- read.csv(here("data/annual_aqi_by_county_2021.csv"))
air_quality_2022 <- read.csv(here("data/annual_aqi_by_county_2021.csv"))
population_data <- read_excel(here("data/co-est2020int-pop.xlsx"), skip=3)
unique_topics <- unique(chronic_diseases$Topic)
print(unique_topics)
chronic_diseases %>%
filter(Topic == "Cancer") %>%
pull(Question) %>%
unique()
chronic_diseases %>%
filter(Topic == "Tobacco") %>%
pull(Question) %>%
unique()
chronic_diseases %>%
filter(Topic == "Sleep") %>%
pull(Question) %>%
unique()
chronic_diseases %>%
filter(Topic == "Nutrition, Physical Activity, and Weight Status") %>%
pull(Question) %>%
unique()
respiratory_diseases <- chronic_diseases %>%
filter(
Topic %in% c("Asthma", "Cancer", "Tobacco", "Nutrition, Physical Activity, and Weight Status") &
(
(Topic == "Cancer" & Question == "Lung and bronchial cancer mortality among all people, underlying cause") |
(Topic == "Tobacco" & Question %in% c(
"Quit attempts in the past year among adult current smokers",
"Current cigarette smoking among adults",
"Cigarette smoking during pregnancy among women with a recent live birth",
"Current electronic vapor product use among high school students"
)) |
(Topic == "Nutrition, Physical Activity, and Weight Status" & Question %in% c(
"Children and adolescents aged 6-13 years meeting aerobic physical activity guideline",
"Met aerobic physical activity guideline among high school students",
"Met aerobic physical activity guideline for substantial health benefits, adults"
)) |
(Topic == "Asthma") |
(Topic == "Chronic Obstructive Pulmonary Disease")
)
)
population_data_cleaned <- population_data %>%
filter(.[[1]] != "United States") %>%
select(1, 8:ncol(.)) %>%
setNames(c("Name", paste0(2015:2020))) %>%
mutate(
County = Name %>%
sub("^\\.", "", .) %>%            # remove leading dot
sub("\\s*County,.*$", "", .)      # remove ' County, ...'
)
air_quality_all <- bind_rows(
air_quality_2015,
air_quality_2016,
air_quality_2017,
air_quality_2018,
air_quality_2019,
air_quality_2020
)
# Modify population data for easy joining with AQI
population_long <- population_data_cleaned %>%
pivot_longer(
cols = starts_with("20"), # get just the years
names_to = "Year",
values_to = "Population"
) %>%
mutate(Year = as.integer(Year))
# Group Air Quality by State
aqi_county <- air_quality_all %>%
group_by(County) %>%
summarise(AQI = mean(Max.AQI, na.rm = TRUE))
scatter_data <- population_long %>%
left_join(aqi_county, by = c("County")) %>%
filter(!is.na(AQI) & !is.na(Population))
ggplot(scatter_data, aes(x = Population, y = AQI, color = AQI)) +
geom_point(alpha = 0.7, size = 2) +
scale_x_continuous(labels = scales::comma) +
scale_color_continuous(
limits = c(0, 450)
) +
scale_y_continuous(
limits = c(0, 450),  # clip y-axis to a reasonable max
) +
labs(
title = "County Population vs Average Max AQI",
x = "County Population",
y = "Average Max AQI",
color = "AQI"
) +
theme_minimal(base_size = 14)
# Combine all air quality datasets into one long table
aqi_long <- bind_rows(
air_quality_2018 %>% mutate(Year = 2018),
air_quality_2019 %>% mutate(Year = 2019),
air_quality_2020 %>% mutate(Year = 2020),
air_quality_2018 %>% mutate(Year = 2021),
air_quality_2018 %>% mutate(Year = 2022)
)
# Average AQI per year
aqi_yearly <- aqi_long %>%
group_by(Year) %>%
summarise(Avg_AQI = mean(Max.AQI, na.rm = TRUE))
ggplot(aqi_yearly, aes(x = Year, y = Avg_AQI)) +
geom_line(size = 1.2, color = "steelblue") +
geom_point(size = 3, color = "steelblue") +
scale_x_continuous(breaks = 2015:2021) +
labs(
title = "Average Maximum AQI by Year",
x = "Year",
y = "Average Max AQI"
) +
theme_minimal(base_size = 14)
# Build a dataset of illness rates by year and illness type
illness_long <- respiratory_diseases %>%
filter(!is.na(DataValue)) %>%
mutate(
Illness = case_when(
Topic == "Asthma" ~ "Asthma",
Topic == "Chronic Obstructive Pulmonary Disease" ~ "COPD",
Topic == "Cancer" ~ "Lung Cancer",
Topic == "Tobacco" ~ "Smoking-Related",
Topic == "Nutrition, Physical Activity, and Weight Status" ~ "Activity (Respiratory-Linked)",
TRUE ~ Topic
),
# Use YearStart when available, otherwise YearEnd
Year = if_else(!is.na(YearStart), YearStart, YearEnd)
) %>%
group_by(Year, Illness) %>%
summarise(Rate = mean(DataValue, na.rm = TRUE), .groups = "drop")
# Filter to consistent reporting years (2018–2022)
illness_18_22 <- illness_long %>%
filter(Year >= 2018, Year <= 2022)
# Plot
ggplot(illness_18_22, aes(x = Year, y = Rate, color = Illness)) +
geom_line(size = 1.2) +
geom_point(size = 3) +
scale_x_continuous(breaks = 2018:2022) +
labs(
title = "Respiratory Illness Rates Over Time (2018–2022)",
x = "Year",
y = "Rate per 100,000",
color = "Illness Type"
) +
theme_minimal(base_size = 14) +
theme_minimal(base_size = 14)
# Build a dataset of illness rates by year and illness type (2018–2022)
illness_long <- respiratory_diseases %>%
filter(YearStart >= 2018 & YearStart <= 2022, !is.na(DataValue)) %>%
mutate(
Illness = case_when(
Topic == "Asthma" ~ "Asthma",
Topic == "Chronic Obstructive Pulmonary Disease" ~ "COPD",
Topic == "Cancer" ~ "Lung Cancer",
Topic == "Tobacco" ~ "Smoking-Related",
Topic == "Nutrition, Physical Activity, and Weight Status" ~ "Activity (Respiratory-Linked)",
TRUE ~ Topic
),
Year = YearStart
) %>%
group_by(Year, Illness) %>%
summarise(Rate = mean(DataValue, na.rm = TRUE), .groups = "drop")
# Plot: 4-dot line chart with bigger points
ggplot(illness_long, aes(x = Year, y = Rate, color = Illness)) +
geom_line(size = 1.2) +
geom_point(size = 5) +  # bigger points
scale_x_continuous(breaks = 2018:2022) +
labs(
title = "Respiratory Illness Rates Over Time (2018–2022)",
x = "Year",
y = "Rate per 100,000",
color = "Illness Type"
) +
theme_minimal(base_size = 14)
us_states <- read_sf(here("data/ne_110m_admin_1_states_provinces.shp"))
us_main <- us_states %>%
filter(!name %in% c("Alaska", "Hawaii"))
disease_data_state <- respiratory_diseases %>%
filter(!is.na(DataValue)) %>%
mutate(postal = LocationAbbr) %>%
group_by(postal) %>%
summarise(DataValue = mean(DataValue, na.rm = TRUE))
us_main_joined <- us_main %>%
left_join(disease_data_state, by = "postal")
ggplot(us_main_joined) +
geom_sf(aes(fill = DataValue), color = "white", size = 0.3) +
scale_fill_viridis_c(
option = "plasma",
na.value = "grey85",
name = "Disease Rate"
) +
annotation_scale(location = "bl", width_hint = 0.25) +
annotation_north_arrow(
location = "bl",
which_north = "true",
style = north_arrow_fancy_orienteering(),
pad_x = unit(0.5, "in"),
pad_y = unit(0.3, "in")
) +
labs(
title = "Respiratory Disease Rates by State",
x = NULL,
y = NULL
) +
theme_minimal(base_size = 14) +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right"
)
